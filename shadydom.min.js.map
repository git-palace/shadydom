{"version":3,"sources":["env.js"],"names":["settings","window","ShadyDOM","hasNativeShadowDOM","Boolean","Element","prototype","attachShadow","Node","getRootNode","desc","Object","getOwnPropertyDescriptor","hasDescriptors","configurable","get","hasNerfedDescriptors","inUse","force","isShadyRoot","obj","__localName","p","matches","matchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","element","selector","call","copyOwnProperty","name","source","target","pd","defineProperty","extend","n$","getOwnPropertyNames","i","n","length","extendAll","sources","mixin","setPrototypeOf","proto","__proto__","patchPrototype","getPrototypeOf","hasOwnProperty","patchProto","create","__sourceProto","__patchProto","promish","Promise","resolve","twiddle","document","createTextNode","content","then","cb","observer","MutationObserver","disconnect","observe","characterData","textContent","newSplice","index","removed","addedCount","EDIT_LEAVE","EDIT_UPDATE","EDIT_ADD","EDIT_DELETE","ArraySplice","calcEditDistances","current","currentStart","currentEnd","old","oldStart","oldEnd","rowCount","columnCount","distances","Array","j","equals","north","west","spliceOperationsFromEditDistances","edits","push","northWest","min","reverse","calcSplices","prefixCount","suffixCount","splice","minLength","Math","sharedPrefix","sharedSuffix","ops","undefined","splices","oldIndex","searchLength","index1","index2","count","calculateSplices","previous","currentValue","previousValue","customElements$1","customElements","flushList","scheduled","flushCount","flushMax","enqueue","callback","flush","shift","isFlushedMaxed","Error","list","escapeAttrRegExp","escapeDataRegExp","escapeReplace","c","escapeAttr","s","replace","escapeData","makeSet","arr","set","voidElements","plaintextParents","getOuterHTML","node","parentNode","composed","nodeType","ELEMENT_NODE","tagName","localName","attrs","attributes","attr","value","getInnerHTML","TEXT_NODE","data","COMMENT_NODE","console","error","c$","childNodes","l","child","nodeWalker","createTreeWalker","NodeFilter","SHOW_ALL","elementWalker","SHOW_ELEMENT","currentNode","firstChild","lastChild","previousSibling","nextSibling","nodes","parentElement","firstElementChild","lastElementChild","previousElementSibling","nextElementSibling","children","innerHTML","nodeValue","textWalker","SHOW_TEXT","nextNode","nativeTree","freeze","getProperty","prop","__shady","hasProperty","recordInsertBefore","container","ref_node","DOCUMENT_FRAGMENT_NODE","linkNode","resetTo","ps","ns","recordRemoveChild","recordChildNodes","nativeAppendChild","appendChild","nativeInsertBefore","insertBefore","nativeRemoveChild","removeChild","nativeSetAttribute","setAttribute","parent","activeElementDesc","Document","getDocumentActiveElement","mixinImpl","addNode","ownerRoot","ownerShadyRootForNode","ipAdded","__noInsertionPoint","_skipUpdateInsertionPoints","_maybeAddInsertionPoint","handled","_maybeDistribute","shadyRoot","removeNode","logicalParent","distributed","maybeDistributeParent","removedDistributed","_removeDistributedChildren","addedInsertionPoint","getInsertionPointTag","update","_removeOwnerShadyRoot","_scheduleObserver","addedNode","removedNode","addedNodes","removedNodes","schedule","removeNodeFromParent","_hasCachedOwnerRoot","__ownerShadyRoot","root","documentElement","contains","insertionPointTag","fragContent","querySelector","wrappedContent","hasContent","needsDist","_nodeNeedsDistribution","added","querySelectorAll","np","na","hasInsertionPoint","hostNeedsDist","ip$","_insertionPoints","insertionPoint","_contains","dc$","assignedNodes","flatten","firstComposedNode","isFinalDestination","clearNode","maybeDistributeAttributeChange","query","matcher","halter","_queryElements","elements","_queryElement","result","activeElementForNode","active","isShadyRoot$$1","host","activeRoot","renderRootNode","render","nativeCloneNode","cloneNode","nativeRemoveAttribute$1","removeAttribute","setAttribute$1","ShadyCSS","ownerDocument","setElementClass","generateSimpleDescriptor","assignedSlotDesc","NodeMixin","replaceChild","deep","nc","defineProperties","tc","cn","join","text","TextMixin","assignedSlot","FragmentMixin","childrenDescriptor","filter","domParser","DOMParser","insertDOMFrom","from","innerHTMLDescriptor","doc","parseFromString","head","body","SlotMixin","options","distributedNodes","ElementMixin","shadowRoot","slot","getAttribute","HTMLElementMixin","activeElementDescriptor","ActiveElementMixin","activeElement","UnderActiveElementMixin","_activeElement","Mixins","Fragment","Text","Slot","HTMLElement","mixin$$1","ifExists","__nativeProps","sd","warn","md","getComposedInnerHTML","getComposedChildNodes","NormalizedEvent","Event","inType","params","e","createEvent","initEvent","bubbles","cancelable","Distributor","distributePool","collectPool","pool","dirtyRoots","p$","distributeInsertionPoint","prevAssignedNodes","clearAssignedSlots","needsSlotChange","anyDistributed","matchesInsertionPoint","_prevAssignedSlot","distributeNodeInto","children$$1","setDistributedNodesOnInsertionPoint","_fireSlotChange","savePrevious","slotName","trim","isInsertionPoint","d$","dispatchEvent","ShadyRoot","frag","createDocumentFragment","ShadyFragmentMixin","_init","ShadyMixin","_renderPending","_hasRendered","_distributor","_getRenderRoot","_rendererForHost","_render","updateInsertionPoints","distribute","compose","forceRender","i$","__insertionPoints","getInsertionPoints","insertionPoints","_composeTree","_updateChildNodes","_composeNode","distributedNode","d","next","DocumentFragment","AsyncObserver","_scheduled","callbacks","Set","mutations","takeRecords","forEach","observeChildren","add","_callback","_observer","_node","unobserveChildren","handle","delete","size","filterMutations","targetRootNode","map","mutation","mutationInScope","m","origAddEventListener","addEventListener","origRemoveEventListener","removeEventListener","alwaysComposed","blur","focus","focusin","focusout","click","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","wheel","beforeinput","input","keydown","keyup","compositionstart","compositionupdate","compositionend","touchstart","touchend","touchmove","touchcancel","pointerover","pointerenter","pointerdown","pointermove","pointerup","pointercancel","pointerout","pointerleave","gotpointercapture","lostpointercapture","dragstart","drag","dragenter","dragleave","dragover","drop","dragend","DOMActivate","DOMFocusIn","DOMFocusOut","keypress","pathComposer","startNode","composedPath","startRoot","retarget","refNode","path","refNodePath","ancestor","lastRoot","rootIdx","indexOf","EventMixin","__patched","isTrusted","__composed","type","__composedPath","__target","currentTarget","relatedTarget","__relatedTarget","__relatedTargetComposedPath","stopPropagation","__propagationStopped","stopImmediatePropagation","__immediatePropagationStopped","mixinComposedFlag","Base","klazz","event","nonBubblingEventsToRetarget","fireHandlers","phase","hs","__handlers","fn","retargetNonBubblingEvent","AT_TARGET","lastFiredRoot","optionsOrCapture","capture","once","passive","__eventWrappers","wrapperFn","eventPhase","BUBBLING_PHASE","bubble","idx","activateFocusEventOverrides","ev","PatchedEvent","PatchedCustomEvent","CustomEvent","PatchedMouseEvent","MouseEvent","patch","createRootAndEnsurePatched","__nativeSetAttribute","classNameDescriptor","h","nativeHTMLElement","he","HTMLSlotElement"],"mappings":"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","file":"shadydom.min.js","sourcesContent":["(function () {\n'use strict';\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nlet settings = window.ShadyDOM || {};\n\nsettings.hasNativeShadowDOM = Boolean(Element.prototype.attachShadow && Node.prototype.getRootNode);\n\nlet desc = Object.getOwnPropertyDescriptor(Node.prototype, 'firstChild');\n\nsettings.hasDescriptors = Boolean(desc && desc.configurable && desc.get);\nsettings.hasNerfedDescriptors = Boolean(desc && !settings.hasDescriptors);\n\n\nsettings.inUse = settings.force || !settings.hasNativeShadowDOM;\n\n\n\nfunction isShadyRoot(obj) {\n  return Boolean(obj.__localName === 'ShadyRoot');\n}\n\nlet p = Element.prototype;\nlet matches = p.matches || p.matchesSelector ||\n  p.mozMatchesSelector || p.msMatchesSelector ||\n  p.oMatchesSelector || p.webkitMatchesSelector;\n\nfunction matchesSelector(element, selector) {\n  return matches.call(element, selector);\n}\n\nfunction copyOwnProperty(name, source, target) {\n  let pd = Object.getOwnPropertyDescriptor(source, name);\n  if (pd) {\n    Object.defineProperty(target, name, pd);\n  }\n}\n\nfunction extend(target, source) {\n  if (target && source) {\n    let n$ = Object.getOwnPropertyNames(source);\n    for (let i=0, n; (i<n$.length) && (n=n$[i]); i++) {\n      copyOwnProperty(n, source, target);\n    }\n  }\n  return target || source;\n}\n\nfunction extendAll(target, ...sources) {\n  for (let i=0; i < sources.length; i++) {\n    extend(target, sources[i]);\n  }\n  return target;\n}\n\nfunction mixin(target, source) {\n  for (var i in source) {\n    target[i] = source[i];\n  }\n  return target;\n}\n\nlet setPrototypeOf = Object.setPrototypeOf || function(obj, proto) {\n  obj.__proto__ = proto;\n  return obj;\n};\n\nfunction patchPrototype(obj, mixin) {\n  let proto = Object.getPrototypeOf(obj);\n  if (!proto.hasOwnProperty('__patchProto')) {\n    let patchProto = Object.create(proto);\n    patchProto.__sourceProto = proto;\n    extend(patchProto, mixin);\n    proto.__patchProto = patchProto;\n  }\n  setPrototypeOf(obj, proto.__patchProto);\n}\n\n\n\n\n\n// TODO(sorvell): actually rely on a real Promise polyfill...\nlet promish;\nif (window.Promise) {\n  promish = Promise.resolve();\n} else {\n  let twiddle = document.createTextNode('');\n  let content = 0;\n  promish = {\n    then(cb) {\n      // To preserve timing with Promise microtasks\n      // we create a new observer for every callback.\n      let observer = new MutationObserver(function() {\n        observer.disconnect();\n        cb();\n      });\n      observer.observe(twiddle, {characterData: true});\n      twiddle.textContent = content++;\n    }\n  };\n}\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nfunction newSplice(index, removed, addedCount) {\n  return {\n    index: index,\n    removed: removed,\n    addedCount: addedCount\n  };\n}\n\nconst EDIT_LEAVE = 0;\nconst EDIT_UPDATE = 1;\nconst EDIT_ADD = 2;\nconst EDIT_DELETE = 3;\n\nlet ArraySplice = {\n\n  // Note: This function is *based* on the computation of the Levenshtein\n  // \"edit\" distance. The one change is that \"updates\" are treated as two\n  // edits - not one. With Array splices, an update is really a delete\n  // followed by an add. By retaining this, we optimize for \"keeping\" the\n  // maximum array items in the original array. For example:\n  //\n  //   'xxxx123' -> '123yyyy'\n  //\n  // With 1-edit updates, the shortest path would be just to update all seven\n  // characters. With 2-edit updates, we delete 4, leave 3, and add 4. This\n  // leaves the substring '123' intact.\n  calcEditDistances(current, currentStart, currentEnd,\n                              old, oldStart, oldEnd) {\n    // \"Deletion\" columns\n    let rowCount = oldEnd - oldStart + 1;\n    let columnCount = currentEnd - currentStart + 1;\n    let distances = new Array(rowCount);\n\n    // \"Addition\" rows. Initialize null column.\n    for (let i = 0; i < rowCount; i++) {\n      distances[i] = new Array(columnCount);\n      distances[i][0] = i;\n    }\n\n    // Initialize null row\n    for (let j = 0; j < columnCount; j++)\n      distances[0][j] = j;\n\n    for (let i = 1; i < rowCount; i++) {\n      for (let j = 1; j < columnCount; j++) {\n        if (this.equals(current[currentStart + j - 1], old[oldStart + i - 1]))\n          distances[i][j] = distances[i - 1][j - 1];\n        else {\n          let north = distances[i - 1][j] + 1;\n          let west = distances[i][j - 1] + 1;\n          distances[i][j] = north < west ? north : west;\n        }\n      }\n    }\n\n    return distances;\n  },\n\n  // This starts at the final weight, and walks \"backward\" by finding\n  // the minimum previous weight recursively until the origin of the weight\n  // matrix.\n  spliceOperationsFromEditDistances(distances) {\n    let i = distances.length - 1;\n    let j = distances[0].length - 1;\n    let current = distances[i][j];\n    let edits = [];\n    while (i > 0 || j > 0) {\n      if (i == 0) {\n        edits.push(EDIT_ADD);\n        j--;\n        continue;\n      }\n      if (j == 0) {\n        edits.push(EDIT_DELETE);\n        i--;\n        continue;\n      }\n      let northWest = distances[i - 1][j - 1];\n      let west = distances[i - 1][j];\n      let north = distances[i][j - 1];\n\n      let min;\n      if (west < north)\n        min = west < northWest ? west : northWest;\n      else\n        min = north < northWest ? north : northWest;\n\n      if (min == northWest) {\n        if (northWest == current) {\n          edits.push(EDIT_LEAVE);\n        } else {\n          edits.push(EDIT_UPDATE);\n          current = northWest;\n        }\n        i--;\n        j--;\n      } else if (min == west) {\n        edits.push(EDIT_DELETE);\n        i--;\n        current = west;\n      } else {\n        edits.push(EDIT_ADD);\n        j--;\n        current = north;\n      }\n    }\n\n    edits.reverse();\n    return edits;\n  },\n\n  /**\n   * Splice Projection functions:\n   *\n   * A splice map is a representation of how a previous array of items\n   * was transformed into a new array of items. Conceptually it is a list of\n   * tuples of\n   *\n   *   <index, removed, addedCount>\n   *\n   * which are kept in ascending index order of. The tuple represents that at\n   * the |index|, |removed| sequence of items were removed, and counting forward\n   * from |index|, |addedCount| items were added.\n   */\n\n  /**\n   * Lacking individual splice mutation information, the minimal set of\n   * splices can be synthesized given the previous state and final state of an\n   * array. The basic approach is to calculate the edit distance matrix and\n   * choose the shortest path through it.\n   *\n   * Complexity: O(l * p)\n   *   l: The length of the current array\n   *   p: The length of the old array\n   */\n  calcSplices(current, currentStart, currentEnd,\n                        old, oldStart, oldEnd) {\n    let prefixCount = 0;\n    let suffixCount = 0;\n    let splice;\n\n    let minLength = Math.min(currentEnd - currentStart, oldEnd - oldStart);\n    if (currentStart == 0 && oldStart == 0)\n      prefixCount = this.sharedPrefix(current, old, minLength);\n\n    if (currentEnd == current.length && oldEnd == old.length)\n      suffixCount = this.sharedSuffix(current, old, minLength - prefixCount);\n\n    currentStart += prefixCount;\n    oldStart += prefixCount;\n    currentEnd -= suffixCount;\n    oldEnd -= suffixCount;\n\n    if (currentEnd - currentStart == 0 && oldEnd - oldStart == 0)\n      return [];\n\n    if (currentStart == currentEnd) {\n      splice = newSplice(currentStart, [], 0);\n      while (oldStart < oldEnd)\n        splice.removed.push(old[oldStart++]);\n\n      return [ splice ];\n    } else if (oldStart == oldEnd)\n      return [ newSplice(currentStart, [], currentEnd - currentStart) ];\n\n    let ops = this.spliceOperationsFromEditDistances(\n        this.calcEditDistances(current, currentStart, currentEnd,\n                               old, oldStart, oldEnd));\n\n    splice = undefined;\n    let splices = [];\n    let index = currentStart;\n    let oldIndex = oldStart;\n    for (let i = 0; i < ops.length; i++) {\n      switch(ops[i]) {\n        case EDIT_LEAVE:\n          if (splice) {\n            splices.push(splice);\n            splice = undefined;\n          }\n\n          index++;\n          oldIndex++;\n          break;\n        case EDIT_UPDATE:\n          if (!splice)\n            splice = newSplice(index, [], 0);\n\n          splice.addedCount++;\n          index++;\n\n          splice.removed.push(old[oldIndex]);\n          oldIndex++;\n          break;\n        case EDIT_ADD:\n          if (!splice)\n            splice = newSplice(index, [], 0);\n\n          splice.addedCount++;\n          index++;\n          break;\n        case EDIT_DELETE:\n          if (!splice)\n            splice = newSplice(index, [], 0);\n\n          splice.removed.push(old[oldIndex]);\n          oldIndex++;\n          break;\n      }\n    }\n\n    if (splice) {\n      splices.push(splice);\n    }\n    return splices;\n  },\n\n  sharedPrefix(current, old, searchLength) {\n    for (let i = 0; i < searchLength; i++)\n      if (!this.equals(current[i], old[i]))\n        return i;\n    return searchLength;\n  },\n\n  sharedSuffix(current, old, searchLength) {\n    let index1 = current.length;\n    let index2 = old.length;\n    let count = 0;\n    while (count < searchLength && this.equals(current[--index1], old[--index2]))\n      count++;\n\n    return count;\n  },\n\n  calculateSplices(current, previous) {\n    return this.calcSplices(current, 0, current.length, previous, 0,\n                            previous.length);\n  },\n\n  equals(currentValue, previousValue) {\n    return currentValue === previousValue;\n  }\n\n};\n\nlet calculateSplices = (current, previous) =>\n  ArraySplice.calculateSplices(current, previous);\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n// render enqueuer/flusher\nlet customElements$1 = window.customElements;\nlet flushList = [];\nlet scheduled;\nlet flushCount = 0;\nlet flushMax = 100;\nfunction enqueue(callback) {\n  if (!scheduled) {\n    scheduled = true;\n    promish.then(flush);\n  }\n  flushList.push(callback);\n}\n\nfunction flush() {\n  scheduled = false;\n  flushCount++;\n  while (flushList.length) {\n    flushList.shift()();\n  }\n  if (customElements$1 && customElements$1.flush) {\n    customElements$1.flush();\n  }\n  // continue flushing after elements are upgraded...\n  const isFlushedMaxed = (flushCount > flushMax);\n  if (flushList.length && !isFlushedMaxed) {\n      flush();\n  }\n  flushCount = 0;\n  if (isFlushedMaxed) {\n    throw new Error('Loop detected in ShadyDOM distribution, aborting.')\n  }\n}\n\nflush.list = flushList;\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n// Cribbed from ShadowDOM polyfill\n// https://github.com/webcomponents/webcomponentsjs/blob/master/src/ShadowDOM/wrappers/HTMLElement.js#L28\n/////////////////////////////////////////////////////////////////////////////\n// innerHTML and outerHTML\n\n// http://www.whatwg.org/specs/web-apps/current-work/multipage/the-end.html#escapingString\nlet escapeAttrRegExp = /[&\\u00A0\"]/g;\nlet escapeDataRegExp = /[&\\u00A0<>]/g;\n\nfunction escapeReplace(c) {\n  switch (c) {\n    case '&':\n      return '&amp;';\n    case '<':\n      return '&lt;';\n    case '>':\n      return '&gt;';\n    case '\"':\n      return '&quot;';\n    case '\\u00A0':\n      return '&nbsp;';\n  }\n}\n\nfunction escapeAttr(s) {\n  return s.replace(escapeAttrRegExp, escapeReplace);\n}\n\nfunction escapeData(s) {\n  return s.replace(escapeDataRegExp, escapeReplace);\n}\n\nfunction makeSet(arr) {\n  let set = {};\n  for (let i = 0; i < arr.length; i++) {\n    set[arr[i]] = true;\n  }\n  return set;\n}\n\n// http://www.whatwg.org/specs/web-apps/current-work/#void-elements\nlet voidElements = makeSet([\n  'area',\n  'base',\n  'br',\n  'col',\n  'command',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'keygen',\n  'link',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr'\n]);\n\nlet plaintextParents = makeSet([\n  'style',\n  'script',\n  'xmp',\n  'iframe',\n  'noembed',\n  'noframes',\n  'plaintext',\n  'noscript'\n]);\n\nfunction getOuterHTML(node, parentNode, composed) {\n  switch (node.nodeType) {\n    case Node.ELEMENT_NODE: {\n      let tagName = node.localName;\n      let s = '<' + tagName;\n      let attrs = node.attributes;\n      for (let i = 0, attr; (attr = attrs[i]); i++) {\n        s += ' ' + attr.name + '=\"' + escapeAttr(attr.value) + '\"';\n      }\n      s += '>';\n      if (voidElements[tagName]) {\n        return s;\n      }\n      return s + getInnerHTML(node, composed) + '</' + tagName + '>';\n    }\n    case Node.TEXT_NODE: {\n      let data = node.data;\n      if (parentNode && plaintextParents[parentNode.localName]) {\n        return data;\n      }\n      return escapeData(data);\n    }\n    case Node.COMMENT_NODE: {\n      return '<!--' + node.data + '-->';\n    }\n    default: {\n      window.console.error(node);\n      throw new Error('not implemented');\n    }\n  }\n}\n\nfunction getInnerHTML(node, composed) {\n  if (node.localName === 'template') {\n    node = node.content;\n  }\n  let s = '';\n  let c$ = composed ? composed(node) : node.childNodes;\n  for (let i=0, l=c$.length, child; (i<l) && (child=c$[i]); i++) {\n    s += getOuterHTML(child, node, composed);\n  }\n  return s;\n}\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nlet nodeWalker = document.createTreeWalker(document, NodeFilter.SHOW_ALL,\n  null, false);\n\nlet elementWalker = document.createTreeWalker(document, NodeFilter.SHOW_ELEMENT,\n  null, false);\n\nfunction parentNode(node) {\n  nodeWalker.currentNode = node;\n  return nodeWalker.parentNode();\n}\n\nfunction firstChild(node) {\n  nodeWalker.currentNode = node;\n  return nodeWalker.firstChild();\n}\n\nfunction lastChild(node) {\n  nodeWalker.currentNode = node;\n  return nodeWalker.lastChild();\n}\n\nfunction previousSibling(node) {\n  nodeWalker.currentNode = node;\n  return nodeWalker.previousSibling();\n}\n\nfunction nextSibling(node) {\n  nodeWalker.currentNode = node;\n  return nodeWalker.nextSibling();\n}\n\nfunction childNodes(node) {\n  let nodes = [];\n  nodeWalker.currentNode = node;\n  let n = nodeWalker.firstChild();\n  while (n) {\n    nodes.push(n);\n    n = nodeWalker.nextSibling();\n  }\n  return nodes;\n}\n\nfunction parentElement(node) {\n  elementWalker.currentNode = node;\n  return elementWalker.parentNode();\n}\n\nfunction firstElementChild(node) {\n  elementWalker.currentNode = node;\n  return elementWalker.firstChild();\n}\n\nfunction lastElementChild(node) {\n  elementWalker.currentNode = node;\n  return elementWalker.lastChild();\n}\n\nfunction previousElementSibling(node) {\n  elementWalker.currentNode = node;\n  return elementWalker.previousSibling();\n}\n\nfunction nextElementSibling(node) {\n  elementWalker.currentNode = node;\n  return elementWalker.nextSibling();\n}\n\nfunction children(node) {\n  let nodes = [];\n  elementWalker.currentNode = node;\n  let n = elementWalker.firstChild();\n  while (n) {\n    nodes.push(n);\n    n = elementWalker.nextSibling();\n  }\n  return nodes;\n}\n\nfunction innerHTML(node) {\n  return getInnerHTML(node, (n) => childNodes(n));\n}\n\nfunction textContent(node) {\n  if (node.nodeType !== Node.ELEMENT_NODE) {\n    return node.nodeValue;\n  }\n  let textWalker = document.createTreeWalker(node, NodeFilter.SHOW_TEXT,\n    null, false);\n  let content = '', n;\n  while ( (n = textWalker.nextNode()) ) {\n    // TODO(sorvell): can't use textContent since we patch it on Node.prototype!\n    // However, should probably patch it only on element.\n    content += n.nodeValue;\n  }\n  return content;\n}\n\nvar nativeTree = Object.freeze({\n\tparentNode: parentNode,\n\tfirstChild: firstChild,\n\tlastChild: lastChild,\n\tpreviousSibling: previousSibling,\n\tnextSibling: nextSibling,\n\tchildNodes: childNodes,\n\tparentElement: parentElement,\n\tfirstElementChild: firstElementChild,\n\tlastElementChild: lastElementChild,\n\tpreviousElementSibling: previousElementSibling,\n\tnextElementSibling: nextElementSibling,\n\tchildren: children,\n\tinnerHTML: innerHTML,\n\ttextContent: textContent\n});\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nfunction getProperty(node, prop) {\n  return node.__shady && node.__shady[prop];\n}\n\nfunction hasProperty(node, prop) {\n  return getProperty(node, prop) !== undefined;\n}\n\nfunction recordInsertBefore(node, container, ref_node) {\n  container.__shady = container.__shady || {};\n  if (hasProperty(container, 'firstChild')) {\n    container.__shady.childNodes = null;\n  }\n  // handle document fragments\n  if (node.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {\n    let c$ = node.childNodes;\n    for (let i=0; i < c$.length; i++) {\n      linkNode(c$[i], container, ref_node);\n    }\n    // cleanup logical dom in doc fragment.\n    node.__shady = node.__shady || {};\n    let resetTo = hasProperty(node, 'firstChild') ? null : undefined;\n    node.__shady.firstChild = node.__shady.lastChild = resetTo;\n    node.__shady.childNodes = resetTo;\n  } else {\n    linkNode(node, container, ref_node);\n  }\n}\n\nfunction linkNode(node, container, ref_node) {\n  ref_node = ref_node || null;\n  node.__shady = node.__shady || {};\n  container.__shady = container.__shady || {};\n  if (ref_node) {\n    ref_node.__shady = ref_node.__shady || {};\n  }\n  // update ref_node.previousSibling <-> node\n  node.__shady.previousSibling = ref_node ? ref_node.__shady.previousSibling :\n    container.lastChild;\n  let ps = node.__shady.previousSibling;\n  if (ps && ps.__shady) {\n    ps.__shady.nextSibling = node;\n  }\n  // update node <-> ref_node\n  let ns = node.__shady.nextSibling = ref_node;\n  if (ns && ns.__shady) {\n    ns.__shady.previousSibling = node;\n  }\n  // update node <-> container\n  node.__shady.parentNode = container;\n  if (ref_node) {\n    if (ref_node === container.__shady.firstChild) {\n      container.__shady.firstChild = node;\n    }\n  } else {\n    container.__shady.lastChild = node;\n    if (!container.__shady.firstChild) {\n      container.__shady.firstChild = node;\n    }\n  }\n  // remove caching of childNodes\n  container.__shady.childNodes = null;\n}\n\nfunction recordRemoveChild(node, container) {\n  node.__shady = node.__shady || {};\n  container.__shady = container.__shady || {};\n  if (node === container.__shady.firstChild) {\n    container.__shady.firstChild = node.__shady.nextSibling;\n  }\n  if (node === container.__shady.lastChild) {\n    container.__shady.lastChild = node.__shady.previousSibling;\n  }\n  let p = node.__shady.previousSibling;\n  let n = node.__shady.nextSibling;\n  if (p) {\n    p.__shady = p.__shady || {};\n    p.__shady.nextSibling = n;\n  }\n  if (n) {\n    n.__shady = n.__shady || {};\n    n.__shady.previousSibling = p;\n  }\n  // When an element is removed, logical data is no longer tracked.\n  // Explicitly set `undefined` here to indicate this. This is disginguished\n  // from `null` which is set if info is null.\n  node.__shady.parentNode = node.__shady.previousSibling =\n    node.__shady.nextSibling = undefined;\n  if (hasProperty(container, 'childNodes')) {\n    // remove caching of childNodes\n    container.__shady.childNodes = null;\n  }\n}\n\nlet recordChildNodes = function(node) {\n  if (!hasProperty(node, 'firstChild')) {\n    node.__shady = node.__shady || {};\n    node.__shady.firstChild = firstChild(node);\n    node.__shady.lastChild = lastChild(node);\n    let c$ = node.__shady.childNodes = childNodes(node);\n    for (let i=0, n; (i<c$.length) && (n=c$[i]); i++) {\n      n.__shady = n.__shady || {};\n      n.__shady.parentNode = node;\n      n.__shady.nextSibling = c$[i+1] || null;\n      n.__shady.previousSibling = c$[i-1] || null;\n    }\n  }\n};\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nlet nativeAppendChild = Element.prototype.appendChild;\nlet nativeInsertBefore = Element.prototype.insertBefore;\nlet nativeRemoveChild = Element.prototype.removeChild;\nlet nativeSetAttribute = Element.prototype.setAttribute;\nfunction appendChild(parent, child) {\n  return nativeAppendChild.call(parent, child);\n}\n\nfunction insertBefore(parent, child, ref_node) {\n  return nativeInsertBefore.call(parent, child, ref_node);\n}\nfunction removeChild(parent, child) {\n  return nativeRemoveChild.call(parent, child);\n}\n\nfunction setAttribute(node, name, value) {\n  nativeSetAttribute.call(node, name, value);\n}\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nlet activeElementDesc = Object.getOwnPropertyDescriptor(Document.prototype, 'activeElement');\nfunction getDocumentActiveElement() {\n  if (activeElementDesc && activeElementDesc.get) {\n    return activeElementDesc.get.call(document);\n  }\n}\n\nlet mixinImpl = {\n\n  // Try to add node. Record logical info, track insertion points, perform\n  // distribution iff needed. Return true if the add is handled.\n  addNode(container, node, ref_node) {\n    let ownerRoot = this.ownerShadyRootForNode(container);\n    let ipAdded;\n    if (ownerRoot) {\n      // optimization: special insertion point tracking\n      // TODO(sorvell): verify that the renderPending check here should not be needed.\n      // if (node.__noInsertionPoint && !ownerRoot._renderPending) {\n      if (node.__noInsertionPoint) {\n        ownerRoot._skipUpdateInsertionPoints = true;\n      }\n      // note: we always need to see if an insertion point is added\n      // since this saves logical tree info; however, invalidation state\n      // needs\n      ipAdded = this._maybeAddInsertionPoint(node, container, ownerRoot);\n      // invalidate insertion points IFF not already invalid!\n      if (ipAdded) {\n        ownerRoot._skipUpdateInsertionPoints = false;\n      }\n    }\n    if (hasProperty(container, 'firstChild')) {\n      recordInsertBefore(node, container, ref_node);\n    }\n    // if not distributing and not adding to host, do a fast path addition\n    // TODO(sorvell): revisit flow since `ipAdded` needed here if\n    // node is a fragment that has a patched QSA.\n    let handled = this._maybeDistribute(node, container, ownerRoot, ipAdded) ||\n      container.shadyRoot;\n    return handled;\n  },\n\n  // Try to remove node: update logical info and perform distribution iff\n  // needed. Return true if the removal has been handled.\n  // note that it's possible for both the node's host and its parent\n  // to require distribution... both cases are handled here.\n  removeNode(node) {\n    // important that we want to do this only if the node has a logical parent\n    let logicalParent = hasProperty(node, 'parentNode') &&\n      getProperty(node, 'parentNode');\n    let distributed;\n    let ownerRoot = this.ownerShadyRootForNode(node);\n    if (logicalParent || ownerRoot) {\n      // distribute node's parent iff needed\n      distributed = this.maybeDistributeParent(node);\n      if (logicalParent) {\n        recordRemoveChild(node, logicalParent);\n      }\n      // remove node from root and distribute it iff needed\n      let removedDistributed = ownerRoot &&\n        this._removeDistributedChildren(ownerRoot, node);\n      let addedInsertionPoint = (logicalParent && ownerRoot &&\n        logicalParent.localName === ownerRoot.getInsertionPointTag());\n      if (removedDistributed || addedInsertionPoint) {\n        ownerRoot._skipUpdateInsertionPoints = false;\n        ownerRoot.update();\n      }\n    }\n    this._removeOwnerShadyRoot(node);\n    return distributed;\n  },\n\n\n  _scheduleObserver(node, addedNode, removedNode) {\n    let observer = node.__shady && node.__shady.observer;\n    if (observer) {\n      if (addedNode) {\n        observer.addedNodes.push(addedNode);\n      }\n      if (removedNode) {\n        observer.removedNodes.push(removedNode);\n      }\n      observer.schedule();\n    }\n  },\n\n  removeNodeFromParent(node, parent) {\n    if (parent) {\n      this._scheduleObserver(parent, null, node);\n      return this.removeNode(node);\n    } else {\n      this._removeOwnerShadyRoot(node);\n    }\n  },\n\n  _hasCachedOwnerRoot(node) {\n    return Boolean(node.__ownerShadyRoot !== undefined);\n  },\n\n  getRootNode(node) {\n    if (!node || !node.nodeType) {\n      return;\n    }\n    let root = node.__ownerShadyRoot;\n    if (root === undefined) {\n      if (isShadyRoot(node)) {\n        root = node;\n      } else {\n        let parent = node.parentNode;\n        root = parent ? this.getRootNode(parent) : node;\n      }\n      // memo-ize result for performance but only memo-ize\n      // result if node is in the document. This avoids a problem where a root\n      // can be cached while an element is inside a fragment.\n      // If this happens and we cache the result, the value can become stale\n      // because for perf we avoid processing the subtree of added fragments.\n      if (document.documentElement.contains(node)) {\n        node.__ownerShadyRoot = root;\n      }\n    }\n    return root;\n  },\n\n  ownerShadyRootForNode(node) {\n    let root = this.getRootNode(node);\n    if (isShadyRoot(root)) {\n      return root;\n    }\n  },\n\n  _maybeDistribute(node, container, ownerRoot, ipAdded) {\n    // TODO(sorvell): technically we should check non-fragment nodes for\n    // <content> children but since this case is assumed to be exceedingly\n    // rare, we avoid the cost and will address with some specific api\n    // when the need arises.  For now, the user must call\n    // distributeContent(true), which updates insertion points manually\n    // and forces distribution.\n    let insertionPointTag = ownerRoot && ownerRoot.getInsertionPointTag() || '';\n    let fragContent = (node.nodeType === Node.DOCUMENT_FRAGMENT_NODE) &&\n      !node.__noInsertionPoint &&\n      insertionPointTag && node.querySelector(insertionPointTag);\n    let wrappedContent = fragContent &&\n      (fragContent.parentNode.nodeType !==\n      Node.DOCUMENT_FRAGMENT_NODE);\n    let hasContent = fragContent || (node.localName === insertionPointTag);\n    // There are 3 possible cases where a distribution may need to occur:\n    // 1. <content> being inserted (the host of the shady root where\n    //    content is inserted needs distribution)\n    // 2. children being inserted into parent with a shady root (parent\n    //    needs distribution)\n    // 3. container is an insertionPoint\n    if (hasContent || (container.localName === insertionPointTag) || ipAdded) {\n      if (ownerRoot) {\n        // note, insertion point list update is handled after node\n        // mutations are complete\n        ownerRoot.update();\n      }\n    }\n    let needsDist = this._nodeNeedsDistribution(container);\n    if (needsDist) {\n      container.shadyRoot.update();\n    }\n    // Return true when distribution will fully handle the composition\n    // Note that if a content was being inserted that was wrapped by a node,\n    // and the parent does not need distribution, return false to allow\n    // the nodes to be added directly, after which children may be\n    // distributed and composed into the wrapping node(s)\n    return needsDist || (hasContent && !wrappedContent);\n  },\n\n  /* note: parent argument is required since node may have an out\n  of date parent at this point; returns true if a <content> is being added */\n  _maybeAddInsertionPoint(node, parent, root) {\n    let added;\n    let insertionPointTag = root.getInsertionPointTag();\n    if (node.nodeType === Node.DOCUMENT_FRAGMENT_NODE &&\n      !node.__noInsertionPoint) {\n      let c$ = node.querySelectorAll(insertionPointTag);\n      for (let i=0, n, np, na; (i<c$.length) && (n=c$[i]); i++) {\n        np = n.parentNode;\n        // don't allow node's parent to be fragment itself\n        if (np === node) {\n          np = parent;\n        }\n        na = this._maybeAddInsertionPoint(n, np, root);\n        added = added || na;\n      }\n    } else if (node.localName === insertionPointTag) {\n      recordChildNodes(parent);\n      recordChildNodes(node);\n      added = true;\n    }\n    return added;\n  },\n\n  _nodeNeedsDistribution(node) {\n    return node && node.shadyRoot &&\n      node.shadyRoot.hasInsertionPoint();\n  },\n\n  _removeDistributedChildren(root, container) {\n    let hostNeedsDist;\n    let ip$ = root._insertionPoints;\n    for (let i=0; i<ip$.length; i++) {\n      let insertionPoint = ip$[i];\n      if (this._contains(container, insertionPoint)) {\n        let dc$ = insertionPoint.assignedNodes({flatten: true});\n        for (let j=0; j<dc$.length; j++) {\n          hostNeedsDist = true;\n          let node = dc$[j];\n          let parent = parentNode(node);\n          if (parent) {\n            removeChild(parent, node);\n          }\n        }\n      }\n    }\n    return hostNeedsDist;\n  },\n\n  _contains(container, node) {\n    while (node) {\n      if (node == container) {\n        return true;\n      }\n      node = node.parentNode;\n    }\n  },\n\n  _removeOwnerShadyRoot(node) {\n    // optimization: only reset the tree if node is actually in a root\n    if (this._hasCachedOwnerRoot(node)) {\n      let c$ = node.childNodes;\n      for (let i=0, l=c$.length, n; (i<l) && (n=c$[i]); i++) {\n        this._removeOwnerShadyRoot(n);\n      }\n    }\n    node.__ownerShadyRoot = undefined;\n  },\n\n  // TODO(sorvell): This will fail if distribution that affects this\n  // question is pending; this is expected to be exceedingly rare, but if\n  // the issue comes up, we can force a flush in this case.\n  firstComposedNode(insertionPoint) {\n    let n$ = insertionPoint.assignedNodes({flatten: true});\n    let root = this.getRootNode(insertionPoint);\n    for (let i=0, l=n$.length, n; (i<l) && (n=n$[i]); i++) {\n      // means that we're composed to this spot.\n      if (root.isFinalDestination(insertionPoint, n)) {\n        return n;\n      }\n    }\n  },\n\n  clearNode(node) {\n    while (node.firstChild) {\n      node.removeChild(node.firstChild);\n    }\n  },\n\n  maybeDistributeParent(node) {\n    let parent = node.parentNode;\n    if (this._nodeNeedsDistribution(parent)) {\n      parent.shadyRoot.update();\n      return true;\n    }\n  },\n\n  maybeDistributeAttributeChange(node, name) {\n    if (name === 'slot') {\n      this.maybeDistributeParent(node);\n    } else if (node.localName === 'slot' && name === 'name') {\n      let root = this.ownerShadyRootForNode(node);\n      if (root) {\n        root.update();\n      }\n    }\n  },\n\n  // NOTE: `query` is used primarily for ShadyDOM's querySelector impl,\n  // but it's also generally useful to recurse through the element tree\n  // and is used by Polymer's styling system.\n  query(node, matcher, halter) {\n    let list = [];\n    this._queryElements(node.childNodes, matcher,\n      halter, list);\n    return list;\n  },\n\n  _queryElements(elements, matcher, halter, list) {\n    for (let i=0, l=elements.length, c; (i<l) && (c=elements[i]); i++) {\n      if (c.nodeType === Node.ELEMENT_NODE &&\n          this._queryElement(c, matcher, halter, list)) {\n        return true;\n      }\n    }\n  },\n\n  _queryElement(node, matcher, halter, list) {\n    let result = matcher(node);\n    if (result) {\n      list.push(node);\n    }\n    if (halter && halter(result)) {\n      return result;\n    }\n    this._queryElements(node.childNodes, matcher,\n      halter, list);\n  },\n\n  activeElementForNode(node) {\n    let active = getDocumentActiveElement();\n    if (!active) {\n      return null;\n    }\n    let isShadyRoot$$1 = !!(isShadyRoot(node));\n    if (node !== document) {\n      // If this node isn't a document or shady root, then it doesn't have\n      // an active element.\n      if (!isShadyRoot$$1) {\n        return null;\n      }\n      // If this shady root's host is the active element or the active\n      // element is not a descendant of the host (in the composed tree),\n      // then it doesn't have an active element.\n      if (node.host === active ||\n          !node.host.contains(active)) {\n        return null;\n      }\n    }\n    // This node is either the document or a shady root of which the active\n    // element is a (composed) descendant of its host; iterate upwards to\n    // find the active element's most shallow host within it.\n    let activeRoot = this.ownerShadyRootForNode(active);\n    while (activeRoot && activeRoot !== node) {\n      active = activeRoot.host;\n      activeRoot = this.ownerShadyRootForNode(active);\n    }\n    if (node === document) {\n      // This node is the document, so activeRoot should be null.\n      return activeRoot ? null : active;\n    } else {\n      // This node is a non-document shady root, and it should be\n      // activeRoot.\n      return activeRoot === node ? active : null;\n    }\n  },\n\n  renderRootNode(element) {\n    var root = element.getRootNode();\n    if (isShadyRoot(root)) {\n      root.render();\n    }\n  }\n\n};\n\nlet nativeCloneNode = Element.prototype.cloneNode;\nlet nativeRemoveAttribute$1 = Element.prototype.removeAttribute;\n\nlet setAttribute$1 = function(attr, value) {\n  // avoid scoping elements in non-main document to avoid template documents\n  if (window.ShadyCSS && attr === 'class' && this.ownerDocument === document) {\n    window.ShadyCSS.setElementClass(this, value);\n  } else {\n    setAttribute(this, attr, value);\n  }\n};\n\nfunction generateSimpleDescriptor(prop) {\n  return {\n    get() {\n      let l = getProperty(this, prop);\n      return l !== undefined ? l : nativeTree[prop](this);\n    },\n    configurable: true\n  }\n}\n\nlet assignedSlotDesc = {\n  get() {\n    return getProperty(this, 'assignedSlot') || null;\n  },\n  configurable: true\n};\n\nlet NodeMixin = {\n\n  appendChild(node) {\n    return this.insertBefore(node);\n  },\n\n  // cases in which we may not be able to just do standard native call\n  // 1. container has a shadyRoot (needsDistribution IFF the shadyRoot\n  // has an insertion point)\n  // 2. container is a shadyRoot (don't distribute, instead set\n  // container to container.host.\n  // 3. node is <content> (host of container needs distribution)\n  insertBefore(node, ref_node) {\n    if (ref_node) {\n      let p = getProperty(ref_node, 'parentNode');\n      if (p !== undefined && p !== this) {\n        throw Error('The ref_node to be inserted before is not a child ' +\n          'of this node');\n      }\n    }\n    // remove node from its current position iff it's in a tree.\n    if (node.nodeType !== Node.DOCUMENT_FRAGMENT_NODE) {\n      let parent = getProperty(node, 'parentNode');\n      mixinImpl.removeNodeFromParent(node, parent);\n    }\n    if (!mixinImpl.addNode(this, node, ref_node)) {\n      if (ref_node) {\n        // if ref_node is an insertion point replace with first distributed node\n        let root = mixinImpl.ownerShadyRootForNode(ref_node);\n        if (root) {\n          ref_node = ref_node.localName === root.getInsertionPointTag() ?\n            mixinImpl.firstComposedNode(ref_node) : ref_node;\n        }\n      }\n      // if adding to a shadyRoot, add to host instead\n      let container = isShadyRoot(this) ?\n        this.host : this;\n      if (ref_node) {\n        insertBefore(container, node, ref_node);\n      } else {\n        appendChild(container, node);\n      }\n    }\n    mixinImpl._scheduleObserver(this, node);\n    return node;\n  },\n\n  /**\n    Removes the given `node` from the element's `lightChildren`.\n    This method also performs dom composition.\n  */\n  removeChild(node) {\n    if (node.parentNode !== this) {\n      throw Error('The node to be removed is not a child of this node: ' +\n        node);\n    }\n    if (!mixinImpl.removeNode(node)) {\n      // if removing from a shadyRoot, remove form host instead\n      let container = isShadyRoot(this) ?\n        this.host :\n        this;\n      // not guaranteed to physically be in container; e.g.\n      // undistributed nodes.\n      let parent = parentNode(node);\n      if (container === parent) {\n        removeChild(container, node);\n      }\n    }\n    mixinImpl._scheduleObserver(this, null, node);\n    return node;\n  },\n\n  replaceChild(node, ref_node) {\n    this.insertBefore(node, ref_node);\n    this.removeChild(ref_node);\n    return node;\n  },\n\n  cloneNode(deep) {\n    if (this.localName == 'template') {\n      return nativeCloneNode.call(this, deep);\n    } else {\n      let n = nativeCloneNode.call(this, false);\n      if (deep) {\n        let c$ = this.childNodes;\n        for (let i=0, nc; i < c$.length; i++) {\n          nc = c$[i].cloneNode(true);\n          n.appendChild(nc);\n        }\n      }\n      return n;\n    }\n  }\n};\n\nObject.defineProperties(NodeMixin, {\n\n  parentElement: generateSimpleDescriptor('parentElement'),\n\n  parentNode: generateSimpleDescriptor('parentNode'),\n\n  nextSibling: generateSimpleDescriptor('nextSibling'),\n\n  previousSibling: generateSimpleDescriptor('previousSibling'),\n\n  childNodes: {\n    get() {\n      if (hasProperty(this, 'firstChild')) {\n        if (!this.__shady.childNodes) {\n          this.__shady.childNodes = [];\n          for (let n=this.firstChild; n; n=n.nextSibling) {\n            this.__shady.childNodes.push(n);\n          }\n        }\n        return this.__shady.childNodes;\n      } else {\n        return childNodes(this);\n      }\n    },\n    configurable: true\n  },\n\n  firstChild: generateSimpleDescriptor('firstChild'),\n\n  lastChild: generateSimpleDescriptor('lastChild'),\n\n  textContent: {\n    get() {\n      if (hasProperty(this, 'firstChild')) {\n        let tc = [];\n        for (let i = 0, cn = this.childNodes, c; (c = cn[i]); i++) {\n          if (c.nodeType !== Node.COMMENT_NODE) {\n            tc.push(c.textContent);\n          }\n        }\n        return tc.join('');\n      } else {\n        return textContent(this);\n      }\n    },\n    set(text) {\n      if (this.nodeType !== Node.ELEMENT_NODE) {\n        // TODO(sorvell): can't do this if patch nodeValue.\n        this.nodeValue = text;\n      } else {\n        mixinImpl.clearNode(this);\n        if (text) {\n          this.appendChild(document.createTextNode(text));\n        }\n      }\n    },\n    configurable: true\n  }\n});\n\n// NOTE: For some reason `Text` redefines `assignedSlot`\nlet TextMixin = extend({}, NodeMixin);\nObject.defineProperties(TextMixin, {\n  assignedSlot: assignedSlotDesc\n});\n\nlet FragmentMixin = {\n\n  // TODO(sorvell): consider doing native QSA and filtering results.\n  querySelector(selector) {\n    // match selector and halt on first result.\n    let result = mixinImpl.query(this, function(n) {\n      return matchesSelector(n, selector);\n    }, function(n) {\n      return Boolean(n);\n    })[0];\n    return result || null;\n  },\n\n  querySelectorAll(selector) {\n    return mixinImpl.query(this, function(n) {\n      return matchesSelector(n, selector);\n    });\n  }\n\n};\n\nlet childrenDescriptor = {\n  get() {\n    if (hasProperty(this, 'firstChild')) {\n      return Array.prototype.filter.call(this.childNodes, function(n) {\n        return (n.nodeType === Node.ELEMENT_NODE);\n      });\n    } else {\n      return children(this);\n    }\n  },\n  configurable: true\n};\n\nlet domParser = new DOMParser();\n\nlet insertDOMFrom = function(target, from) {\n  let c$ = Array.from(from.childNodes);\n  for (let i=0; i < c$.length; i++) {\n    target.appendChild(c$[i]);\n  }\n};\n\nlet innerHTMLDescriptor = {\n  get() {\n    if (hasProperty(this, 'firstChild')) {\n      return getInnerHTML(this);\n    } else {\n      return innerHTML(this);\n    }\n  },\n  set(text) {\n    mixinImpl.clearNode(this);\n    let doc = domParser.parseFromString(text, 'text/html');\n    if (doc.head) {\n      insertDOMFrom(this, doc.head);\n    }\n    if (doc.body) {\n      insertDOMFrom(this, doc.body);\n    }\n  },\n  configurable: true\n};\n\nObject.defineProperties(FragmentMixin, {\n\n  children: childrenDescriptor,\n\n  innerHTML: innerHTMLDescriptor,\n\n  firstElementChild: {\n    get() {\n      if (hasProperty(this, 'firstChild')) {\n        let n = this.firstChild;\n        while (n && n.nodeType !== Node.ELEMENT_NODE) {\n          n = n.nextSibling;\n        }\n        return n;\n      } else {\n        return firstElementChild(this);\n      }\n    },\n    configurable: true\n  },\n\n  lastElementChild: {\n    get() {\n      if (hasProperty(this, 'lastChild')) {\n        let n = this.lastChild;\n        while (n && n.nodeType !== Node.ELEMENT_NODE) {\n          n = n.previousSibling;\n        }\n        return n;\n      } else {\n        return lastElementChild(this);\n      }\n    },\n    configurable: true\n  }\n\n});\n\nlet SlotMixin = {\n  assignedNodes(options) {\n    if (this.localName === 'slot') {\n      mixinImpl.renderRootNode(this);\n      return this.__shady ?\n        ((options && options.flatten ? this.__shady.distributedNodes :\n        this.__shady.assignedNodes) || []) :\n        [];\n    }\n  }\n};\n\nlet ElementMixin = extendAll({}, FragmentMixin, SlotMixin, {\n  // importNode(externalNode, deep) {\n  //   // for convenience use this node's ownerDoc if the node isn't a document\n  //   let doc = this instanceof Document ? this :\n  //     this.ownerDocument;\n  //   let n = nativeImportNode.call(doc, externalNode, false);\n  //   if (deep) {\n  //     let c$ = externalNode.childNodes;\n  //     for (let i=0, nc; i < c$.length; i++) {\n  //       nc = doc.importNode(c$[i], true);\n  //       n.appendChild(nc);\n  //     }\n  //   }\n  //   return n;\n  // },\n\n  // TODO(sorvell): should only exist on <slot>\n\n  setAttribute(name, value) {\n    setAttribute$1.call(this, name, value);\n    mixinImpl.maybeDistributeAttributeChange(this, name);\n  },\n\n  removeAttribute(name) {\n    nativeRemoveAttribute$1.call(this, name);\n    mixinImpl.maybeDistributeAttributeChange(this, name);\n  }\n});\n\nObject.defineProperties(ElementMixin, {\n\n  assignedSlot: assignedSlotDesc,\n\n  shadowRoot: {\n    get() {\n      return this.shadyRoot;\n    },\n    set(value) {\n      this.shadyRoot = value;\n    },\n    configurable: true\n  },\n\n  nextElementSibling: {\n    get() {\n      if (hasProperty(this, 'nextSibling')) {\n        let n = this.nextSibling;\n        while (n && n.nodeType !== Node.ELEMENT_NODE) {\n          n = n.nextSibling;\n        }\n        return n;\n      } else {\n        return nextElementSibling(this);\n      }\n    },\n    configurable: true\n  },\n\n  previousElementSibling: {\n    get() {\n      if (hasProperty(this, 'previousSibling')) {\n        let n = this.previousSibling;\n        while (n && n.nodeType !== Node.ELEMENT_NODE) {\n          n = n.previousSibling;\n        }\n        return n;\n      } else {\n        return previousElementSibling(this);\n      }\n    },\n    configurable: true\n  },\n\n  slot: {\n    get() {\n      return this.getAttribute('slot');\n    },\n    set(value) {\n      this.setAttribute('slot', value);\n    }\n  }\n\n});\n\nlet HTMLElementMixin = {};\n\nObject.defineProperties(HTMLElementMixin, {\n\n  children: childrenDescriptor,\n\n  innerHTML: innerHTMLDescriptor\n\n});\n\nlet activeElementDescriptor = {\n  get() {\n    return mixinImpl.activeElementForNode(this);\n  }\n};\n\nlet ActiveElementMixin = {};\nObject.defineProperties(ActiveElementMixin, {\n  activeElement: activeElementDescriptor\n});\n\nlet UnderActiveElementMixin = {};\nObject.defineProperties(UnderActiveElementMixin, {\n  _activeElement: activeElementDescriptor\n});\n\n\n\nlet Mixins = {\n\n  Node: NodeMixin,\n\n  Fragment: FragmentMixin,\n\n  Text: TextMixin,\n\n  Slot: SlotMixin,\n\n  Element: ElementMixin,\n\n  HTMLElement: HTMLElementMixin,\n\n  // Note: activeElement cannot be patched on document!\n  Document: extendAll({}, ElementMixin,\n    UnderActiveElementMixin, ActiveElementMixin)\n\n};\n\nlet patchProto = function(proto, mixin$$1, ifExists) {\n  proto.__nativeProps = Object.create(proto.__nativeProps || {});\n  let n$ = Object.getOwnPropertyNames(mixin$$1);\n  for (let i=0, n; (i<n$.length) && (n=n$[i]); i++) {\n    let sd = Object.getOwnPropertyDescriptor(proto, n);\n    if (sd) {\n      if (!sd.configurable) {\n        window.console.warn('Could not patch', n, 'on', proto);\n        return;\n      }\n      proto.__nativeProps[n] = sd;\n    }\n    if (!ifExists || (sd && sd.configurable)) {\n      let md = Object.getOwnPropertyDescriptor(mixin$$1, n);\n      Object.defineProperty(proto, n, md);\n    }\n  }\n};\n\nlet getRootNode = function(node) {\n  return mixinImpl.getRootNode(node);\n};\n\nlet getComposedInnerHTML = function(node) {\n  return getInnerHTML(node, (n) => getComposedChildNodes(n));\n};\n\nlet getComposedChildNodes = function(node) {\n  return childNodes(node);\n};\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n// NOTE: normalize event contruction where necessary (IE11)\nlet NormalizedEvent = typeof Event === 'function' ? Event :\n  function(inType, params) {\n    params = params || {};\n    var e = document.createEvent('Event');\n    e.initEvent(inType, Boolean(params.bubbles), Boolean(params.cancelable));\n    return e;\n  };\n\nvar Distributor = class {\n\n  constructor(root) {\n    this.root = root;\n    this.insertionPointTag = 'slot';\n  }\n\n  getInsertionPoints() {\n    return this.root.querySelectorAll(this.insertionPointTag);\n  }\n\n  hasInsertionPoint() {\n    return Boolean(this.root._insertionPoints &&\n      this.root._insertionPoints.length);\n  }\n\n  isInsertionPoint(node) {\n    return node.localName && node.localName == this.insertionPointTag;\n  }\n\n  distribute() {\n    if (this.hasInsertionPoint()) {\n      return this.distributePool(this.root, this.collectPool());\n    }\n    return [];\n  }\n\n  // Gather the pool of nodes that should be distributed. We will combine\n  // these with the \"content root\" to arrive at the composed tree.\n  collectPool() {\n    let host = this.root.host;\n    let pool=[], i=0;\n    for (let n=host.firstChild; n; n=n.nextSibling) {\n      pool[i++] = n;\n    }\n    return pool;\n  }\n\n  // perform \"logical\" distribution; note, no actual dom is moved here,\n  // instead elements are distributed into storage\n  // array where applicable.\n  distributePool(node, pool) {\n    let dirtyRoots = [];\n    let p$ = this.root._insertionPoints;\n    for (let i=0, l=p$.length, p; (i<l) && (p=p$[i]); i++) {\n      this.distributeInsertionPoint(p, pool);\n      // provoke redistribution on insertion point parents\n      // must do this on all candidate hosts since distribution in this\n      // scope invalidates their distribution.\n      // only get logical parent.\n      let parent = p.parentNode;\n      if (parent && parent.shadyRoot &&\n          this.hasInsertionPoint(parent.shadyRoot)) {\n        dirtyRoots.push(parent.shadyRoot);\n      }\n    }\n    for (let i=0; i < pool.length; i++) {\n      let p = pool[i];\n      if (p) {\n        p.__shady = p.__shady || {};\n        p.__shady.assignedSlot = undefined;\n        // remove undistributed elements from physical dom.\n        let parent = parentNode(p);\n        if (parent) {\n          removeChild(parent, p);\n        }\n      }\n    }\n    return dirtyRoots;\n  }\n\n  distributeInsertionPoint(insertionPoint, pool) {\n    let prevAssignedNodes = insertionPoint.__shady.assignedNodes;\n    if (prevAssignedNodes) {\n      this.clearAssignedSlots(insertionPoint, true);\n    }\n    insertionPoint.__shady.assignedNodes = [];\n    let needsSlotChange = false;\n    // distribute nodes from the pool that this selector matches\n    let anyDistributed = false;\n    for (let i=0, l=pool.length, node; i < l; i++) {\n      node=pool[i];\n      // skip nodes that were already used\n      if (!node) {\n        continue;\n      }\n      // distribute this node if it matches\n      if (this.matchesInsertionPoint(node, insertionPoint)) {\n        if (node.__shady._prevAssignedSlot != insertionPoint) {\n          needsSlotChange = true;\n        }\n        this.distributeNodeInto(node, insertionPoint);\n        // remove this node from the pool\n        pool[i] = undefined;\n        // since at least one node matched, we won't need fallback content\n        anyDistributed = true;\n      }\n    }\n    // Fallback content if nothing was distributed here\n    if (!anyDistributed) {\n      let children$$1 = insertionPoint.childNodes;\n      for (let j = 0, node; j < children$$1.length; j++) {\n        node = children$$1[j];\n        if (node.__shady._prevAssignedSlot != insertionPoint) {\n          needsSlotChange = true;\n        }\n        this.distributeNodeInto(node, insertionPoint);\n      }\n    }\n    // we're already dirty if a node was newly added to the slot\n    // and we're also dirty if the assigned count decreased.\n    if (prevAssignedNodes) {\n      // TODO(sorvell): the tracking of previously assigned slots\n      // could instead by done with a Set and then we could\n      // avoid needing to iterate here to clear the info.\n      for (let i=0; i < prevAssignedNodes.length; i++) {\n        prevAssignedNodes[i].__shady._prevAssignedSlot = null;\n      }\n      if (insertionPoint.__shady.assignedNodes.length < prevAssignedNodes.length) {\n        needsSlotChange = true;\n      }\n    }\n    this.setDistributedNodesOnInsertionPoint(insertionPoint);\n    if (needsSlotChange) {\n      this._fireSlotChange(insertionPoint);\n    }\n  }\n\n  clearAssignedSlots(slot, savePrevious) {\n    let n$ = slot.__shady.assignedNodes;\n    if (n$) {\n      for (let i=0; i < n$.length; i++) {\n        let n = n$[i];\n        if (savePrevious) {\n          n.__shady._prevAssignedSlot = n.__shady.assignedSlot;\n        }\n        // only clear if it was previously set to this slot;\n        // this helps ensure that if the node has otherwise been distributed\n        // ignore it.\n        if (n.__shady.assignedSlot === slot) {\n          n.__shady.assignedSlot = null;\n        }\n      }\n    }\n  }\n\n  matchesInsertionPoint(node, insertionPoint) {\n    let slotName = insertionPoint.getAttribute('name');\n    slotName = slotName ? slotName.trim() : '';\n    let slot = node.getAttribute && node.getAttribute('slot');\n    slot = slot ? slot.trim() : '';\n    return (slot == slotName);\n  }\n\n  distributeNodeInto(child, insertionPoint) {\n    insertionPoint.__shady.assignedNodes.push(child);\n    child.__shady.assignedSlot = insertionPoint;\n  }\n\n  setDistributedNodesOnInsertionPoint(insertionPoint) {\n    let n$ = insertionPoint.__shady.assignedNodes;\n    insertionPoint.__shady.distributedNodes = [];\n    for (let i=0, n; (i<n$.length) && (n=n$[i]) ; i++) {\n      if (this.isInsertionPoint(n)) {\n        let d$ = n.__shady.distributedNodes;\n        if (d$) {\n          for (let j=0; j < d$.length; j++) {\n            insertionPoint.__shady.distributedNodes.push(d$[j]);\n          }\n        }\n      } else {\n        insertionPoint.__shady.distributedNodes.push(n$[i]);\n      }\n    }\n  }\n\n  _fireSlotChange(insertionPoint) {\n    // NOTE: cannot bubble correctly here so not setting bubbles: true\n    // Safari tech preview does not bubble but chrome does\n    // Spec says it bubbles (https://dom.spec.whatwg.org/#mutation-observers)\n    insertionPoint.dispatchEvent(new NormalizedEvent('slotchange'));\n    if (insertionPoint.__shady.assignedSlot) {\n      this._fireSlotChange(insertionPoint.__shady.assignedSlot);\n    }\n  }\n\n  isFinalDestination(insertionPoint) {\n    return !(insertionPoint.__shady.assignedSlot);\n  }\n\n};\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n/**\n  Implements a pared down version of ShadowDOM's scoping, which is easy to\n  polyfill across browsers.\n*/\nclass ShadyRoot {\n\n  constructor(host) {\n    if (!host) {\n      throw 'Must provide a host';\n    }\n    // NOTE: this strange construction is necessary because\n    // DocumentFragment cannot be subclassed on older browsers.\n    let frag = document.createDocumentFragment();\n    frag.__proto__ = ShadyFragmentMixin;\n    frag._init(host);\n    return frag;\n  }\n\n}\n\nlet ShadyMixin = {\n\n  _init(host) {\n    // NOTE: set a fake local name so this element can be\n    // distinguished from a DocumentFragment when patching.\n    // FF doesn't allow this to be `localName`\n    this.__localName = 'ShadyRoot';\n    // root <=> host\n    host.shadowRoot = this;\n    this.host = host;\n    // logical dom setup\n    recordChildNodes(host);\n    recordChildNodes(this);\n    // state flags\n    this._renderPending = false;\n    this._hasRendered = false;\n    this._distributor = new Distributor(this);\n    this.update();\n  },\n\n  // async render\n  update() {\n    if (!this._renderPending) {\n      this._renderPending = true;\n      enqueue(() => this.render());\n    }\n  },\n\n  _getRenderRoot() {\n    let root = this._rendererForHost();\n    // TODO(sorvell): actually want the highest dirty root in distribution tree\n    return root ? root._getRenderRoot() : this;\n  },\n\n  // Returns the shadyRoot `this.host` if `this.host`\n  // has children that require distribution.\n  _rendererForHost() {\n    let root = this.host.getRootNode();\n    if (isShadyRoot(root)) {\n      let c$ = this.host.childNodes;\n      for (let i=0, c; i < c$.length; i++) {\n        c = c$[i];\n        if (this._distributor.isInsertionPoint(c)) {\n          return root;\n        }\n      }\n    }\n  },\n\n  render() {\n    if (this._renderPending) {\n      this._getRenderRoot()._render();\n    }\n  },\n\n  _render() {\n    this._renderPending = false;\n    if (!this._skipUpdateInsertionPoints) {\n      this.updateInsertionPoints();\n    } else if (!this._hasRendered) {\n      this._insertionPoints = [];\n    }\n    this._skipUpdateInsertionPoints = false;\n    // TODO(sorvell): can add a first render optimization here\n    // to use if there are no insertion points\n    // 1. clear host node of composed children\n    // 2. appendChild the shadowRoot itself or (more robust) its logical children\n    // NOTE: this didn't seem worth it in perf testing\n    // but not ready to delete this info.\n    // logical\n    this.distribute();\n    // physical\n    this.compose();\n    this._hasRendered = true;\n  },\n\n  forceRender() {\n    this._renderPending = true;\n    this.render();\n  },\n\n  distribute() {\n    let dirtyRoots = this._distributor.distribute();\n    for (let i=0; i<dirtyRoots.length; i++) {\n      dirtyRoots[i]._render();\n    }\n  },\n\n  updateInsertionPoints() {\n    let i$ = this.__insertionPoints;\n    // if any insertion points have been removed, clear their distribution info\n    if (i$) {\n      for (let i=0, c; i < i$.length; i++) {\n        c = i$[i];\n        if (c.getRootNode() !== this) {\n          this._distributor.clearAssignedSlots(c);\n        }\n      }\n    }\n    i$ = this._insertionPoints = this._distributor.getInsertionPoints();\n    // ensure insertionPoints's and their parents have logical dom info.\n    // save logical tree info\n    // a. for shadyRoot\n    // b. for insertion points (fallback)\n    // c. for parents of insertion points\n    for (let i=0, c; i < i$.length; i++) {\n      c = i$[i];\n      c.__shady = c.__shady || {};\n      recordChildNodes(c);\n      recordChildNodes(c.parentNode);\n    }\n  },\n\n  get _insertionPoints() {\n    if (!this.__insertionPoints) {\n      this.updateInsertionPoints();\n    }\n    return this.__insertionPoints || (this.__insertionPoints = []);\n  },\n\n  set _insertionPoints(insertionPoints) {\n    this.__insertionPoints = insertionPoints;\n  },\n\n  hasInsertionPoint() {\n    return this._distributor.hasInsertionPoint();\n  },\n\n  compose() {\n    // compose self\n    // note: it's important to mark this clean before distribution\n    // so that attachment that provokes additional distribution (e.g.\n    // adding something to your parentNode) works\n    this._composeTree();\n    // TODO(sorvell): See fast paths here in Polymer v1\n    // (these seem unnecessary)\n  },\n\n  // Reify dom such that it is at its correct rendering position\n  // based on logical distribution.\n  _composeTree() {\n    this._updateChildNodes(this.host, this._composeNode(this.host));\n    let p$ = this._insertionPoints || [];\n    for (let i=0, l=p$.length, p, parent; (i<l) && (p=p$[i]); i++) {\n      parent = p.parentNode;\n      if ((parent !== this.host) && (parent !== this)) {\n        this._updateChildNodes(parent, this._composeNode(parent));\n      }\n    }\n  },\n\n  // Returns the list of nodes which should be rendered inside `node`.\n  _composeNode(node) {\n    let children$$1 = [];\n    let c$ = (node.shadyRoot || node).childNodes;\n    for (let i = 0; i < c$.length; i++) {\n      let child = c$[i];\n      if (this._distributor.isInsertionPoint(child)) {\n        let distributedNodes = child.__shady.distributedNodes ||\n          (child.__shady.distributedNodes = []);\n        for (let j = 0; j < distributedNodes.length; j++) {\n          let distributedNode = distributedNodes[j];\n          if (this.isFinalDestination(child, distributedNode)) {\n            children$$1.push(distributedNode);\n          }\n        }\n      } else {\n        children$$1.push(child);\n      }\n    }\n    return children$$1;\n  },\n\n  isFinalDestination(insertionPoint, node) {\n    return this._distributor.isFinalDestination(\n      insertionPoint, node);\n  },\n\n  // Ensures that the rendered node list inside `container` is `children`.\n  _updateChildNodes(container, children$$1) {\n    let composed = Array.from(isShadyRoot(container) ?\n      container.childNodes :\n      childNodes(container));\n    let splices = calculateSplices(children$$1, composed);\n    // process removals\n    for (let i=0, d=0, s; (i<splices.length) && (s=splices[i]); i++) {\n      for (let j=0, n; (j < s.removed.length) && (n=s.removed[j]); j++) {\n        // check if the node is still where we expect it is before trying\n        // to remove it; this can happen if we move a node and\n        // then schedule its previous host for distribution resulting in\n        // the node being removed here.\n        if (parentNode(n) === container) {\n          removeChild(container, n);\n        }\n        composed.splice(s.index + d, 1);\n      }\n      d -= s.addedCount;\n    }\n    // process adds\n    for (let i=0, s, next; (i<splices.length) && (s=splices[i]); i++) { //eslint-disable-line no-redeclare\n      next = composed[s.index];\n      for (let j=s.index, n; j < s.index + s.addedCount; j++) {\n        n = children$$1[j];\n        insertBefore(container, n, next);\n        // TODO(sorvell): is this splice strictly needed?\n        composed.splice(j, 0, n);\n      }\n    }\n  },\n\n  getInsertionPointTag() {\n    return this._distributor.insertionPointTag;\n  }\n\n};\n\nlet ShadyFragmentMixin = Object.create(DocumentFragment.prototype);\nextendAll(ShadyFragmentMixin, ShadyMixin, Mixins.Fragment);\nObject.defineProperty(ShadyFragmentMixin, 'activeElement', activeElementDescriptor);\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nclass AsyncObserver {\n\n  constructor() {\n    this._scheduled = false;\n    this.addedNodes = [];\n    this.removedNodes = [];\n    this.callbacks = new Set();\n  }\n\n  schedule() {\n    if (!this._scheduled) {\n      this._scheduled = true;\n      promish.then(() => {\n        this.flush();\n      });\n    }\n  }\n\n  flush() {\n    if (this._scheduled) {\n      this._scheduled = false;\n      let mutations = this.takeRecords();\n      if (mutations.length) {\n        this.callbacks.forEach(function(cb) {\n          cb(mutations);\n        });\n      }\n    }\n  }\n\n  takeRecords() {\n    if (this.addedNodes.length || this.removedNodes.length) {\n      let mutations = [{\n        addedNodes: this.addedNodes,\n        removedNodes: this.removedNodes\n      }];\n      this.addedNodes = [];\n      this.removedNodes = [];\n      return mutations;\n    }\n    return [];\n  }\n\n}\n\n// TODO(sorvell): consider instead polyfilling MutationObserver\n// directly so that users do not have to fork their code.\n// Supporting the entire api may be challenging: e.g. filtering out\n// removed nodes in the wrong scope and seeing non-distributing\n// subtree child mutations.\nlet observeChildren = function(node, callback) {\n  //utils.common.patchNode(node);\n  if (!node.__shady.observer) {\n    node.__shady.observer = new AsyncObserver();\n  }\n  node.__shady.observer.callbacks.add(callback);\n  let observer = node.__shady.observer;\n  return {\n    _callback: callback,\n    _observer: observer,\n    _node: node,\n    takeRecords() {\n      return observer.takeRecords()\n    }\n  };\n};\n\nlet unobserveChildren = function(handle) {\n  let observer = handle && handle._observer;\n  if (observer) {\n    observer.callbacks.delete(handle._callback);\n    if (!observer.callbacks.size) {\n      handle._node.__shady.observer = null;\n    }\n  }\n};\n\nfunction filterMutations(mutations, target) {\n  const targetRootNode = target.getRootNode();\n  return mutations.map(function(mutation) {\n    const mutationInScope = (targetRootNode === mutation.target.getRootNode());\n    if (mutationInScope && mutation.addedNodes) {\n      let nodes = Array.from(mutation.addedNodes).filter(function(n) {\n        return (targetRootNode === n.getRootNode());\n      });\n      if (nodes.length) {\n        mutation = Object.create(mutation);\n        Object.defineProperty(mutation, 'addedNodes', {\n          value: nodes,\n          configurable: true\n        });\n        return mutation;\n      }\n    } else if (mutationInScope) {\n      return mutation;\n    }\n  }).filter(function(m) { return m});\n}\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nlet origAddEventListener = Element.prototype.addEventListener;\nlet origRemoveEventListener = Element.prototype.removeEventListener;\n\n// https://github.com/w3c/webcomponents/issues/513#issuecomment-224183937\nlet alwaysComposed = {\n  blur: true,\n  focus: true,\n  focusin: true,\n  focusout: true,\n  click: true,\n  dblclick: true,\n  mousedown: true,\n  mouseenter: true,\n  mouseleave: true,\n  mousemove: true,\n  mouseout: true,\n  mouseover: true,\n  mouseup: true,\n  wheel: true,\n  beforeinput: true,\n  input: true,\n  keydown: true,\n  keyup: true,\n  compositionstart: true,\n  compositionupdate: true,\n  compositionend: true,\n  touchstart: true,\n  touchend: true,\n  touchmove: true,\n  touchcancel: true,\n  pointerover: true,\n  pointerenter: true,\n  pointerdown: true,\n  pointermove: true,\n  pointerup: true,\n  pointercancel: true,\n  pointerout: true,\n  pointerleave: true,\n  gotpointercapture: true,\n  lostpointercapture: true,\n  dragstart: true,\n  drag: true,\n  dragenter: true,\n  dragleave: true,\n  dragover: true,\n  drop: true,\n  dragend: true,\n  DOMActivate: true,\n  DOMFocusIn: true,\n  DOMFocusOut: true,\n  keypress: true\n};\n\nfunction pathComposer(startNode, composed) {\n  let composedPath = [];\n  let current = startNode;\n  let startRoot = startNode === window ? window : startNode.getRootNode();\n  while (current) {\n    composedPath.push(current);\n    if (current.assignedSlot) {\n      current = current.assignedSlot;\n    } else if (current.nodeType === Node.DOCUMENT_FRAGMENT_NODE && current.host && (composed || current !== startRoot)) {\n      current = current.host;\n    } else {\n      current = current.parentNode;\n    }\n  }\n  // event composedPath includes window when startNode's ownerRoot is document\n  if (composedPath[composedPath.length - 1] === document) {\n    composedPath.push(window);\n  }\n  return composedPath;\n}\n\nfunction retarget(refNode, path) {\n  if (!isShadyRoot) {\n    return refNode;\n  }\n  // If ANCESTOR's root is not a shadow root or ANCESTOR's root is BASE's\n  // shadow-including inclusive ancestor, return ANCESTOR.\n  let refNodePath = pathComposer(refNode, true);\n  let p$ = path;\n  for (let i=0, ancestor, lastRoot, root, rootIdx; i < p$.length; i++) {\n    ancestor = p$[i];\n    root = ancestor === window ? window : ancestor.getRootNode();\n    if (root !== lastRoot) {\n      rootIdx = refNodePath.indexOf(root);\n      lastRoot = root;\n    }\n    if (!isShadyRoot(root) || rootIdx > -1) {\n      return ancestor;\n    }\n  }\n}\n\nlet EventMixin = {\n\n  __patched: 5,\n\n  get composed() {\n    if (this.isTrusted && this.__composed === undefined) {\n      this.__composed = alwaysComposed[this.type];\n    }\n    return this.__composed || false;\n  },\n\n  composedPath() {\n    if (!this.__composedPath) {\n      this.__composedPath = pathComposer(this.__target, this.composed);\n    }\n    return this.__composedPath;\n  },\n\n  get target() {\n    return retarget(this.currentTarget, this.composedPath());\n  },\n\n  // http://w3c.github.io/webcomponents/spec/shadow/#event-relatedtarget-retargeting\n  get relatedTarget() {\n    if (!this.__relatedTarget) {\n      return null;\n    }\n    if (!this.__relatedTargetComposedPath) {\n      this.__relatedTargetComposedPath = pathComposer(this.__relatedTarget, true);\n    }\n    // find the deepest node in relatedTarget composed path that is in the same root with the currentTarget\n    return retarget(this.currentTarget, this.__relatedTargetComposedPath);\n  },\n  stopPropagation() {\n    Event.prototype.stopPropagation.call(this);\n    this.__propagationStopped = true;\n  },\n  stopImmediatePropagation() {\n    Event.prototype.stopImmediatePropagation.call(this);\n    this.__immediatePropagationStopped = true;\n    this.__propagationStopped = true;\n  }\n\n};\n\nfunction mixinComposedFlag(Base) {\n  // NOTE: avoiding use of `class` here so that transpiled output does not\n  // try to do `Base.call` with a dom construtor.\n  let klazz = function(type, options) {\n    let event = new Base(type, options);\n    event.__composed = options && Boolean(options.composed);\n    return event;\n  };\n  // put constructor properties on subclass\n  mixin(klazz, Base);\n  klazz.prototype = Base.prototype;\n  return klazz;\n}\n\nlet nonBubblingEventsToRetarget = {\n  focus: true,\n  blur: true\n};\n\nfunction fireHandlers(event, node, phase) {\n  let hs = node.__handlers && node.__handlers[event.type] &&\n    node.__handlers[event.type][phase];\n  if (hs) {\n    for (let i = 0, fn; (fn = hs[i]); i++) {\n      fn.call(node, event);\n      if (event.__immediatePropagationStopped) {\n        return;\n      }\n    }\n  }\n}\n\nfunction retargetNonBubblingEvent(e) {\n  let path = e.composedPath();\n  let node;\n  // override `currentTarget` to let patched `target` calculate correctly\n  Object.defineProperty(e, 'currentTarget', {\n    get: function() {\n      return node;\n    },\n    configurable: true\n  });\n  for (let i = path.length - 1; i >= 0; i--) {\n    node = path[i];\n    // capture phase fires all capture handlers\n    fireHandlers(e, node, 'capture');\n    if (e.__propagationStopped) {\n      return;\n    }\n  }\n\n  // set the event phase to `AT_TARGET` as in spec\n  Object.defineProperty(e, 'eventPhase', {value: Event.AT_TARGET});\n\n  // the event only needs to be fired when owner roots change when iterating the event path\n  // keep track of the last seen owner root\n  let lastFiredRoot;\n  for (let i = 0; i < path.length; i++) {\n    node = path[i];\n    if (i === 0 || (node.shadowRoot && node.shadowRoot === lastFiredRoot)) {\n      fireHandlers(e, node, 'bubble');\n      // don't bother with window, it doesn't have `getRootNode` and will be last in the path anyway\n      if (node !== window) {\n        lastFiredRoot = node.getRootNode();\n      }\n      if (e.__propagationStopped) {\n        return;\n      }\n    }\n  }\n}\n\nfunction addEventListener(type, fn, optionsOrCapture) {\n  if (!fn) {\n    return;\n  }\n\n  // The callback `fn` might be used for multiple nodes/events. Since we generate\n  // a wrapper function, we need to keep track of it when we remove the listener.\n  // It's more efficient to store the node/type/options information as Array in\n  // `fn` itself rather than the node (we assume that the same callback is used\n  // for few nodes at most, whereas a node will likely have many event listeners).\n  // NOTE(valdrin) invoking external functions is costly, inline has better perf.\n  let capture, once, passive;\n  if (typeof optionsOrCapture === 'object') {\n    capture = Boolean(optionsOrCapture.capture);\n    once = Boolean(optionsOrCapture.once);\n    passive = Boolean(optionsOrCapture.passive);\n  } else {\n    capture = Boolean(optionsOrCapture);\n    once = false;\n    passive = false;\n  }\n  if (fn.__eventWrappers) {\n    // Stop if the wrapper function has already been created.\n    for (let i = 0; i < fn.__eventWrappers.length; i++) {\n      if (fn.__eventWrappers[i].node === this &&\n          fn.__eventWrappers[i].type === type &&\n          fn.__eventWrappers[i].capture === capture &&\n          fn.__eventWrappers[i].once === once &&\n          fn.__eventWrappers[i].passive === passive) {\n        return;\n      }\n    }\n  } else {\n    fn.__eventWrappers = [];\n  }\n\n  const wrapperFn = function(e) {\n    // Support `once` option.\n    if (once) {\n      this.removeEventListener(type, fn, optionsOrCapture);\n    }\n    if (!e.__target) {\n      e.__target = e.target;\n      e.__relatedTarget = e.relatedTarget;\n      patchPrototype(e, EventMixin);\n    }\n    // There are two critera that should stop events from firing on this node\n    // 1. the event is not composed and the current node is not in the same root as the target\n    // 2. when bubbling, if after retargeting, relatedTarget and target point to the same node\n    if (e.composed || e.composedPath().indexOf(this) > -1) {\n      if (e.eventPhase === Event.BUBBLING_PHASE) {\n        if (e.target === e.relatedTarget) {\n          e.stopImmediatePropagation();\n          return;\n        }\n      }\n      return fn(e);\n    }\n  };\n  // Store the wrapper information.\n  fn.__eventWrappers.push({\n    node: this,\n    type: type,\n    capture: capture,\n    once: once,\n    passive: passive,\n    wrapperFn: wrapperFn\n  });\n\n  if (nonBubblingEventsToRetarget[type]) {\n    this.__handlers = this.__handlers || {};\n    this.__handlers[type] = this.__handlers[type] || {capture: [], bubble: []};\n    this.__handlers[type][capture ? 'capture' : 'bubble'].push(wrapperFn);\n  } else {\n    origAddEventListener.call(this, type, wrapperFn, optionsOrCapture);\n  }\n}\n\nfunction removeEventListener(type, fn, optionsOrCapture) {\n  if (!fn) {\n    return;\n  }\n\n  // NOTE(valdrin) invoking external functions is costly, inline has better perf.\n  let capture, once, passive;\n  if (typeof optionsOrCapture === 'object') {\n    capture = Boolean(optionsOrCapture.capture);\n    once = Boolean(optionsOrCapture.once);\n    passive = Boolean(optionsOrCapture.passive);\n  } else {\n    capture = Boolean(optionsOrCapture);\n    once = false;\n    passive = false;\n  }\n  // Search the wrapped function.\n  let wrapperFn = undefined;\n  if (fn.__eventWrappers) {\n    for (let i = 0; i < fn.__eventWrappers.length; i++) {\n      if (fn.__eventWrappers[i].node === this &&\n          fn.__eventWrappers[i].type === type &&\n          fn.__eventWrappers[i].capture === capture &&\n          fn.__eventWrappers[i].once === once &&\n          fn.__eventWrappers[i].passive === passive) {\n        wrapperFn = fn.__eventWrappers.splice(i, 1)[0].wrapperFn;\n        // Cleanup.\n        if (!fn.__eventWrappers.length) {\n          fn.__eventWrappers = undefined;\n        }\n        break;\n      }\n    }\n  }\n\n  origRemoveEventListener.call(this, type, wrapperFn || fn, optionsOrCapture);\n  if (wrapperFn && nonBubblingEventsToRetarget[type] &&\n      this.__handlers && this.__handlers[type]) {\n    const arr = this.__handlers[type][capture ? 'capture' : 'bubble'];\n    const idx = arr.indexOf(wrapperFn);\n    if (idx > -1) {\n      arr.splice(idx, 1);\n    }\n  }\n}\n\nfunction activateFocusEventOverrides() {\n  for (let ev in nonBubblingEventsToRetarget) {\n    window.addEventListener(ev, function(e) {\n      if (!e.__target) {\n        e.__target = e.target;\n        e.__relatedTarget = e.relatedTarget;\n        patchPrototype(e, EventMixin);\n        retargetNonBubblingEvent(e);\n        e.stopImmediatePropagation();\n      }\n    }, true);\n  }\n}\n\n\nlet PatchedEvent = mixinComposedFlag(Event);\nlet PatchedCustomEvent = mixinComposedFlag(CustomEvent);\nlet PatchedMouseEvent = mixinComposedFlag(MouseEvent);\n\n/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n/**\n * Patches elements that interacts with ShadyDOM\n * such that tree traversal and mutation apis act like they would under\n * ShadowDOM.\n *\n * This import enables seemless interaction with ShadyDOM powered\n * custom elements, enabling better interoperation with 3rd party code,\n * libraries, and frameworks that use DOM tree manipulation apis.\n */\n\nif (settings.inUse) {\n\n  window.ShadyDOM = {\n    // TODO(sorvell): remove when Polymer does not depend on this.\n    inUse: settings.inUse,\n    // TODO(sorvell): remove when Polymer does not depend on this.\n    patch: function(node) { return node; },\n    getComposedInnerHTML: getComposedInnerHTML,\n    getComposedChildNodes: getComposedChildNodes,\n    isShadyRoot: isShadyRoot,\n    // TODO(sorvell): exposed for testing only, worth it?\n    enqueue: enqueue,\n    flush: flush,\n    settings: settings,\n    filterMutations: filterMutations,\n    observeChildren: observeChildren,\n    unobserveChildren: unobserveChildren\n  };\n\n  let createRootAndEnsurePatched = function(node) {\n    // TODO(sorvell): need to ensure ancestors are patched but this introduces\n    // a timing problem with gathering composed children.\n    // (1) currently the child list is crawled and patched when patching occurs\n    // (this needs to change)\n    // (2) we can only patch when an element has received its parsed children\n    // because we cannot detect them when inserted by parser.\n    // let ancestor = node;\n    // while (ancestor) {\n    //   patchNode(ancestor);\n    //   ancestor = ancestor.parentNode || ancestor.host;\n    // }\n    //patch.patchNode(node);\n    let root = new ShadyRoot(node);\n    //patch.patchNode(root);\n    return root;\n  };\n\n  Element.prototype.attachShadow = function() {\n    return createRootAndEnsurePatched(this);\n  };\n\n  Node.prototype.addEventListener = addEventListener;\n  Node.prototype.removeEventListener = removeEventListener;\n  Event = PatchedEvent;\n  CustomEvent = PatchedCustomEvent;\n  MouseEvent = PatchedMouseEvent;\n  activateFocusEventOverrides();\n\n  Object.defineProperty(Node.prototype, 'isConnected', {\n    get() {\n      return document.documentElement.contains(this);\n    },\n    configurable: true\n  });\n\n  Node.prototype.getRootNode = function(options) {\n    return getRootNode(this, options);\n  };\n\n  Object.defineProperty(Element.prototype, 'slot', {\n    get() {\n      return this.getAttribute('slot');\n    },\n    set(value) {\n      this.setAttribute('slot', value);\n    },\n    configurable: true\n  });\n\n  Object.defineProperty(Node.prototype, 'assignedSlot', {\n    get() {\n      return (this.__shady && this.__shady.assignedSlot) || null;\n    },\n    configurable: true\n  });\n\n  let nativeSetAttribute = Element.prototype.setAttribute;\n  Element.prototype.setAttribute = setAttribute$1;\n  // NOTE: expose native setAttribute to allow hooking native method\n  // (e.g. this is done in ShadyCSS)\n  Element.prototype.__nativeSetAttribute = nativeSetAttribute;\n\n  let classNameDescriptor = {\n    get() {\n      return this.getAttribute('class');\n    },\n    set(value) {\n      this.setAttribute('class', value);\n    },\n    configurable: true\n  };\n\n\n  // Safari 9 `className` is not configurable\n  let cn = Object.getOwnPropertyDescriptor(Element.prototype, 'className');\n  if (cn && cn.configurable) {\n    Object.defineProperty(Element.prototype, 'className', classNameDescriptor);\n  } else {\n    // on IE `className` is on Element\n    let h = window.customElements && window.customElements.nativeHTMLElement ||\n      HTMLElement;\n    cn = Object.getOwnPropertyDescriptor(h.prototype, 'className');\n    if (cn && cn.configurable) {\n      Object.defineProperty(h.prototype, 'className', classNameDescriptor);\n    }\n  }\n\n  patchProto(Node.prototype, Mixins.Node);\n  patchProto(Text.prototype, Mixins.Text);\n  patchProto(DocumentFragment.prototype, Mixins.Fragment);\n  patchProto(Element.prototype, Mixins.Element);\n  let he = (window.customElements && customElements.nativeHTMLElement) ||\n    HTMLElement;\n  patchProto(he.prototype, Mixins.HTMLElement, true);\n  patchProto(Document.prototype, Mixins.Document);\n  if (window.HTMLSlotElement) {\n    patchProto(HTMLSlotElement.prototype, Mixins.Slot);\n  }\n\n  // Safari 9 testing\n  // patchProto(Text.prototype, Mixins.Node);\n  // patchProto(he.prototype, Mixins.Node);\n  // patchProto(he.prototype, Mixins.Element);\n\n}\n\n}());\n"]}